#!/usr/bin/env node

const program = require('commander')
const chalk = require('chalk')
const fs = require('fs')
const path = require('path')
const {
  createFile,
  hasFile
} = require('../utils/file')

program
  .version('1.0.15')

program
  .command('init')
  .description(chalk.gray('Init'))
  .action(() => {
    hasFile({
      to: `./.vue-make-cli.json`
    }).then(() => {
      createFile({
        from: path.resolve(__dirname, '../templates/[init].json'),
        to: `./.vue-make-cli.json`
      })
    }).catch(() => {
      console.log('Cancelled')
    })
  })

program
  .command('mixin [name]')
  .description(chalk.gray('Create a new mixin'))
  .action((name, options) => {
    hasFile({
      to: `./src/mixins/${name}.js`
    }).then(() => {
      createFile({
        from: path.resolve(__dirname, '../templates/[mixin].js'),
        to: `./src/mixins/${name}.js`,
        replaceKey: name
      })
    }).catch(() => {
      console.log('Cancelled')
    })
  })

program
  .command('store [moduleName]')
  .description(chalk.gray('Create a new module for store'))
  .action((moduleName, options) => {
    hasFile({
      to: `./src/store/modules/${moduleName}.js`
    }).then(() => {
      createFile({
        from: path.resolve(__dirname, '../templates/[store-module].js'),
        to: `./src/store/modules/${moduleName}.js`,
        replaceKey: moduleName
      })
    }).catch(() => {
      console.log('Cancelled')
    })
  })

program
  .command('directive [name]')
  .description(chalk.gray('Create a new directive'))
  .action((name, options) => {
    hasFile({
      to: `./src/directives/${name}.js`
    }).then(() => {
      createFile({
        from: path.resolve(__dirname, '../templates/[directive].js'),
        to: `./src/directives/${name}.js`,
        replaceKey: name
      })
    }).catch(() => {
      console.log('Cancelled')
    })
  })

program
  .command('view [viewPath]')
  .description(chalk.gray('Create a new view'))
  .action((viewPath, options) => {
    hasFile({
      to: `./src/views/${viewPath}`
    }).then(() => {
      fs.readdirSync(path.resolve(__dirname, '../templates/[view]')).forEach(file => {
        createFile({
          from: path.resolve(__dirname, `../templates/[view]/${file}`),
          to: `./src/views/${viewPath}/${file}`,
          replaceKey: viewPath.split('/').pop().toLowerCase()
        })
      })
    }).catch(() => {
      console.log('Cancelled')
    })
  })

program
  .command('page [pagePath]')
  .description(chalk.gray('Create a new page'))
  .action((pagePath, options) => {
    hasFile({
      to: `./src/pages/${pagePath}`
    }).then(() => {
      fs.readdirSync(path.resolve(__dirname, '../templates/[page]')).forEach(file => {
        createFile({
          from: path.resolve(__dirname, `../templates/[page]/${file}`),
          to: `./src/pages/${pagePath}/${file}`,
          replaceKey: pagePath.split('/').pop().toLowerCase()
        })
      })
    }).catch(() => {
      console.log('Cancelled')
    })
  })

program
  .command('component [name]')
  .description(chalk.gray('Create a new component'))
  .action((name, options) => {
    hasFile({
      to: `./src/components/${name}`
    }).then(() => {
      fs.readdirSync(path.resolve(__dirname, '../templates/[component]')).forEach(file => {
        createFile({
          from: path.resolve(__dirname, `../templates/[component]/${file}`),
          to: `./src/components/${name}/${file}`,
          replaceKey: name
        })
      })
    }).catch(() => {
      console.log('Cancelled')
    })
  })

// program
//   .command('*')
//   .action(function (name, options) {
//     console.log(name, options)
//   })

program.on('--help', () => {
  console.log()
  console.log('  Examples:')
  console.log()
  console.log('    $ vue-make --help')
  console.log('    $ vue-make -h')
})

program.parse(process.argv)
